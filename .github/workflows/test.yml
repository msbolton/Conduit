name: Test Suite

on:
  push:
    branches: [ master, develop ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v5
      with:
        dotnet-version: '8.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build core libraries
      run: |
        dotnet build src/Conduit.Api/Conduit.Api.csproj --no-restore
        dotnet build src/Conduit.Common/Conduit.Common.csproj --no-restore
        dotnet build src/Conduit.Messaging/Conduit.Messaging.csproj --no-restore
        dotnet build src/Conduit.Pipeline/Conduit.Pipeline.csproj --no-restore

    - name: Run Common Tests
      run: dotnet test tests/Conduit.Common.Tests/Conduit.Common.Tests.csproj --filter "SimpleGuardTests|SimpleResultTests|SimpleErrorTests" --logger "console;verbosity=normal" --no-restore

    - name: Run Messaging Tests
      run: dotnet test tests/Conduit.Messaging.Tests/Conduit.Messaging.Tests.csproj --filter "SimpleMessagingTests" --logger "console;verbosity=normal" --no-restore

    - name: Run Integration Tests
      run: dotnet test tests/Conduit.Integration.Tests/Conduit.Integration.Tests.csproj --logger "console;verbosity=normal" --no-restore

    - name: Test Summary
      run: |
        echo "âœ… Test Results Summary:"
        echo "  - Common utilities (Guard, Result, Error): 20 tests"
        echo "  - Messaging components: 10 tests"
        echo "  - Cross-module integration: 6 tests"
        echo "  - Total functional test coverage: 36 tests"